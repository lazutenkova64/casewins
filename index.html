<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseWins - Открывай кейсы CS2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Общие стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --primary-color: #9d4edd;
            --primary-dark: #7b2cbf;
            --secondary-color: #240046;
            --accent-color: #10002b;
            --light-color: #f8f9fa;
            --dark-color: #0a0a0a;
            --red-color: #ff0054;
            --purple-color: #c77dff;
            --blue-color: #5a189a;
            --glass-bg: rgba(30, 15, 45, 0.85);
            --glass-border: rgba(157, 78, 221, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--secondary-color) 100%);
            color: var(--light-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(157, 78, 221, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 84, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(199, 125, 255, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Шапка */
        header {
            background: linear-gradient(180deg, rgba(36, 0, 70, 0.95) 0%, rgba(36, 0, 70, 0.85) 100%);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 26px;
            font-weight: 800;
            color: var(--light-color);
            text-transform: uppercase;
            cursor: pointer;
        }

        .logo i {
            color: var(--primary-color);
            font-size: 30px;
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo span {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .online-counter {
            background: linear-gradient(45deg, #00b894, #55efc4);
            color: var(--dark-color);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 20px;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
        }

        .online-counter i {
            color: var(--dark-color);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        nav a {
            color: var(--light-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            transition: var(--transition);
            padding: 10px 18px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.3), transparent);
            transition: var(--transition);
        }

        nav a:hover::before {
            left: 100%;
        }

        nav a:hover, nav a.active {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.4);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .balance {
            background: linear-gradient(45deg, var(--primary-dark), var(--blue-color));
            padding: 10px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            border: 1px solid rgba(157, 78, 221, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .balance i {
            color: #ffd700;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
        }

        .user-avatar:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.5);
        }

        .logout-header-btn {
            background: linear-gradient(45deg, #2a2f36, #3a3f46);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .logout-header-btn:hover {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            transform: translateY(-2px);
        }

        /* Кнопка админ-панели */
        .admin-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: var(--transition);
            font-size: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.4);
        }

        .admin-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 30px rgba(157, 78, 221, 0.6);
        }

        .admin-btn.visible {
            display: flex;
        }

        /* Основной контент */
        main {
            padding: 50px 0 100px;
            display: flex;
            gap: 30px;
        }

        .page-title {
            font-size: 52px;
            margin-bottom: 40px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color), var(--red-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Боковая панель с историей выпадений */
        .drops-sidebar {
            width: 300px;
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 25px;
            height: fit-content;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 100px;
            margin-right: 30px;
        }

        .drops-title {
            font-size: 24px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary-color);
            font-weight: 800;
        }

        .drops-title i {
            font-size: 26px;
            color: var(--purple-color);
        }

        .drops-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 650px;
            overflow: hidden;
            position: relative;
        }

        .drops-container {
            position: relative;
            height: 100%;
        }

        .drop-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(45deg, rgba(36, 0, 70, 0.6), rgba(90, 24, 154, 0.4));
            padding: 18px;
            border-radius: 15px;
            border-left: 4px solid;
            animation: slideDown 25s linear infinite;
            margin-bottom: 15px;
            opacity: 0;
            position: absolute;
            width: 100%;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        @keyframes slideDown {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(650px);
                opacity: 0;
            }
        }

        .drop-avatar {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .drop-info {
            flex: 1;
            min-width: 0;
        }

        .drop-user {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drop-user span {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .drop-item-name {
            font-size: 14px;
            color: #ffd700;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .drop-value {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }

        /* Основная секция с кейсами */
        .main-content {
            flex: 1;
        }

        /* Секция выбора кейсов */
        .case-selection {
            margin-bottom: 60px;
        }

        .section-title {
            font-size: 32px;
            margin-bottom: 35px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--light-color);
            font-weight: 800;
        }

        .section-title i {
            color: var(--primary-color);
            font-size: 36px;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 35px;
        }

        .case-card {
            background: linear-gradient(145deg, rgba(36, 0, 70, 0.9), rgba(16, 0, 43, 0.9));
            border-radius: 25px;
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--glass-border);
            cursor: pointer;
            position: relative;
            backdrop-filter: blur(20px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .case-card:hover {
            transform: translateY(-15px) scale(1.02);
            border-color: var(--primary-color);
            box-shadow: 0 25px 50px rgba(157, 78, 221, 0.3);
        }

        .case-card.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 40px rgba(157, 78, 221, 0.6);
            transform: translateY(-10px);
        }

        .case-image {
            height: 220px;
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--secondary-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .case-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(157, 78, 221, 0.2), transparent);
            transform: translateX(-100%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            100% {
                transform: translateX(100%);
            }
        }

        .case-image img {
            max-width: 75%;
            max-height: 75%;
            object-fit: contain;
            filter: drop-shadow(0 0 25px rgba(255, 255, 255, 0.1));
            transition: var(--transition);
            z-index: 1;
            position: relative;
        }

        .case-card:hover .case-image img {
            transform: scale(1.08);
            filter: drop-shadow(0 0 30px rgba(157, 78, 221, 0.3));
        }

        .case-info {
            padding: 30px;
            position: relative;
        }

        .case-name {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 15px;
            color: var(--light-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .case-price {
            color: #ffd700;
            font-weight: 800;
            font-size: 22px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .case-price i {
            color: #ffd700;
            font-size: 24px;
        }

        .case-items {
            display: flex;
            justify-content: space-between;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 25px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(157, 78, 221, 0.1);
        }

        .open-case-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .open-case-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            font-weight: 800;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.3);
            position: relative;
            overflow: hidden;
        }

        .open-case-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .open-case-btn:hover::before {
            left: 100%;
        }

        .open-case-btn:hover {
            background: linear-gradient(45deg, var(--purple-color), var(--primary-color));
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(157, 78, 221, 0.5);
        }

        .open-case-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(45deg, #666, #888);
        }

        .case-stats {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat {
            background: linear-gradient(45deg, rgba(36, 0, 70, 0.6), rgba(90, 24, 154, 0.4));
            padding: 10px 18px;
            border-radius: 12px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(157, 78, 221, 0.1);
        }

        /* Секция открытия кейса */
        .case-opening-section {
            background: linear-gradient(135deg, rgba(36, 0, 70, 0.95), rgba(16, 0, 43, 0.95));
            border-radius: 30px;
            padding: 45px;
            margin-bottom: 60px;
            display: none;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .case-opening-section.active {
            display: flex;
        }

        .opening-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 45px;
        }

        .opening-title {
            font-size: 36px;
            font-weight: 800;
            color: var(--light-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .opening-title i {
            color: var(--primary-color);
        }

        .close-opening {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            color: var(--light-color);
            width: 55px;
            height: 55px;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-opening:hover {
            background: var(--primary-color);
            transform: rotate(90deg);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.4);
        }

        .case-opening-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            margin-bottom: 45px;
            height: 300px;
            border-radius: 25px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(36, 0, 70, 0.6));
            border: 2px solid var(--glass-border);
            display: flex;
            align-items: center;
        }

        .case-items-scroll {
            display: flex;
            gap: 0;
            padding: 35px 0;
            transition: transform 0.1s linear;
            width: max-content;
            height: 100%;
        }

        .scroll-item {
            width: 240px;
            height: 260px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
            flex-shrink: 0;
            position: relative;
        }

        .scroll-item.active {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(199, 125, 255, 0.15));
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(157, 78, 221, 0.7);
            z-index: 2;
            border-color: var(--primary-color);
        }

        .scroll-item img {
            width: 180px;
            height: 135px;
            object-fit: contain;
            margin-bottom: 20px;
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.6));
            transition: var(--transition);
        }

        .scroll-item.active img {
            filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.6));
        }

        .scroll-item-name {
            font-size: 16px;
            text-align: center;
            font-weight: 700;
            margin-bottom: 12px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light-color);
        }

        .scroll-item-price {
            color: #ffd700;
            font-weight: 800;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .selection-indicator {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, transparent, var(--primary-color), transparent);
            z-index: 3;
            pointer-events: none;
        }

        .selection-indicator::before {
            content: '▼';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--primary-color);
            font-size: 30px;
            text-shadow: 0 0 20px var(--primary-color);
        }

        .center-open-btn {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 24px;
            font-weight: 800;
            border-radius: 20px;
            cursor: pointer;
            z-index: 4;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 15px 40px rgba(157, 78, 221, 0.5);
        }

        .center-open-btn:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 20px 50px rgba(157, 78, 221, 0.7);
        }

        .center-open-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #666, #888);
        }

        .case-opening-controls {
            display: flex;
            gap: 35px;
            align-items: center;
            width: 100%;
            justify-content: center;
        }

        .spin-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            padding: 22px 70px;
            font-size: 22px;
            font-weight: 800;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 12px 35px rgba(157, 78, 221, 0.4);
            position: relative;
            overflow: hidden;
        }

        .spin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .spin-btn:hover::before {
            left: 100%;
        }

        .spin-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 20px 45px rgba(157, 78, 221, 0.6);
            background: linear-gradient(45deg, var(--purple-color), var(--primary-color));
        }

        .spin-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(45deg, #666, #888);
        }

        .items-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
            width: 100%;
            margin-top: 45px;
            padding-top: 35px;
            border-top: 1px solid var(--glass-border);
        }

        .preview-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            border: 1px solid transparent;
            backdrop-filter: blur(10px);
        }

        .preview-item:hover {
            border-color: var(--glass-border);
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .preview-item img {
            width: 120px;
            height: 90px;
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.4));
        }

        .preview-name {
            font-size: 14px;
            text-align: center;
            font-weight: 700;
            color: var(--light-color);
        }

        .preview-price {
            color: #ffd700;
            font-size: 16px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(36, 0, 70, 0.95), rgba(16, 0, 43, 0.95));
            width: 90%;
            max-width: 1000px;
            border-radius: 30px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            animation: modalAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(30px);
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalAppear {
            from { 
                transform: scale(0.8) translateY(30px);
                opacity: 0; 
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1; 
            }
        }

        .modal-header {
            background: linear-gradient(90deg, var(--primary-color), var(--purple-color));
            padding: 30px;
            text-align: center;
            font-size: 36px;
            font-weight: 800;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-modal-btn {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal-btn:hover {
            background: rgba(0, 0, 0, 0.5);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 45px;
        }

        .won-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin: 45px 0;
        }

        .item-image {
            width: 320px;
            height: 240px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, rgba(157, 78, 221, 0.15) 0%, transparent 70%);
            border-radius: 25px;
            padding: 30px;
            border: 2px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .item-image::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.15), transparent);
            transform: rotate(45deg);
            animation: shineEffect 3s infinite;
        }

        @keyframes shineEffect {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .item-image img {
            max-width: 100%;
            max-height: 100%;
            filter: drop-shadow(0 15px 40px rgba(0, 0, 0, 0.6));
            position: relative;
            z-index: 1;
        }

        .item-name {
            font-size: 36px;
            font-weight: 800;
            color: #ffd700;
            text-align: center;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .item-price {
            font-size: 28px;
            font-weight: 800;
            color: var(--light-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .item-rarity {
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 16px;
            letter-spacing: 1.5px;
        }

        .rarity-common {
            background: linear-gradient(45deg, rgba(150, 150, 150, 0.2), rgba(100, 100, 100, 0.2));
            color: #969696;
            border: 1px solid #969696;
        }

        .rarity-uncommon {
            background: linear-gradient(45deg, rgba(77, 181, 58, 0.2), rgba(60, 140, 45, 0.2));
            color: #4db53a;
            border: 1px solid #4db53a;
        }

        .rarity-rare {
            background: linear-gradient(45deg, rgba(76, 110, 244, 0.2), rgba(60, 90, 200, 0.2));
            color: #4c6ef4;
            border: 1px solid #4c6ef4;
        }

        .rarity-mythical {
            background: linear-gradient(45deg, rgba(182, 80, 155, 0.2), rgba(150, 60, 120, 0.2));
            color: #b6509b;
            border: 1px solid #b6509b;
        }

        .rarity-legendary {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.2), rgba(200, 170, 0, 0.2));
            color: #ffd700;
            border: 1px solid #ffd700;
        }

        .rarity-ancient {
            background: linear-gradient(45deg, rgba(235, 75, 75, 0.2), rgba(200, 50, 50, 0.2));
            color: #eb4b4b;
            border: 1px solid #eb4b4b;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 45px;
        }

        .modal-btn {
            padding: 18px 45px;
            border: none;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-modal {
            background: linear-gradient(45deg, #2a2f36, #3a3f46);
            color: white;
        }

        .close-modal:hover {
            background: linear-gradient(45deg, #3a3f46, #4a4f56);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .open-again {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
        }

        .open-again:hover {
            background: linear-gradient(45deg, var(--purple-color), var(--primary-color));
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(157, 78, 221, 0.4);
        }

        .sell-btn {
            background: linear-gradient(45deg, var(--red-color), #ff4066);
            color: white;
        }

        .sell-btn:hover {
            background: linear-gradient(45deg, #ff4066, var(--red-color));
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 0, 84, 0.4);
        }

        /* Админ панель */
        .admin-panel {
            background: linear-gradient(135deg, rgba(36, 0, 70, 0.95), rgba(16, 0, 43, 0.95));
            width: 90%;
            max-width: 600px;
            border-radius: 30px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        .admin-form {
            padding: 45px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--light-color);
            font-size: 16px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 18px 25px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            color: white;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(157, 78, 221, 0.3);
        }

        .admin-actions {
            display: flex;
            gap: 25px;
            margin-top: 45px;
        }

        .admin-btn-submit {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            flex: 1;
            transition: var(--transition);
        }

        .admin-btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(157, 78, 221, 0.4);
        }

        .admin-btn-cancel {
            background: linear-gradient(45deg, #2a2f36, #3a3f46);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            flex: 1;
            transition: var(--transition);
        }

        .admin-btn-cancel:hover {
            background: linear-gradient(45deg, #3a3f46, #4a4f46);
            transform: translateY(-3px);
        }

        /* Чат поддержки */
        .support-chat {
            display: flex;
            flex-direction: column;
            height: 400px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-message {
            max-width: 80%;
            padding: 15px;
            border-radius: 15px;
            position: relative;
        }

        .message-user {
            background: linear-gradient(45deg, rgba(157, 78, 221, 0.2), rgba(199, 125, 255, 0.1));
            align-self: flex-start;
        }

        .message-admin {
            background: linear-gradient(45deg, rgba(0, 184, 148, 0.2), rgba(85, 239, 196, 0.1));
            align-self: flex-end;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .chat-input-area input {
            flex: 1;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-size: 16px;
        }

        .chat-input-area button {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
        }

        .support-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        /* Страница профиля */
        .profile-page {
            display: none;
        }

        .profile-page.active {
            display: block;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .profile-back-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            transition: var(--transition);
        }

        .profile-back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.4);
        }

        .profile-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .profile-sidebar {
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            height: fit-content;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 20px;
            overflow: hidden;
            margin: 0 auto 25px;
            border: 3px solid var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 800;
            color: white;
        }

        .profile-info h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 28px;
            color: var(--light-color);
        }

        .profile-stats {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-stat {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: linear-gradient(45deg, rgba(36, 0, 70, 0.6), rgba(90, 24, 154, 0.4));
            border-radius: 12px;
            border: 1px solid var(--glass-border);
        }

        .profile-main {
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
        }

        .inventory-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            color: rgba(255, 255, 255, 0.7);
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn.active {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            border-color: var(--primary-color);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .inventory-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            border: 1px solid transparent;
            position: relative;
        }

        .inventory-item.sold {
            opacity: 0.5;
        }

        .inventory-item.sold::after {
            content: 'ПРОДАНО';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            background: var(--red-color);
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: 800;
            font-size: 14px;
            letter-spacing: 1px;
            z-index: 2;
        }

        .inventory-item:hover {
            border-color: var(--glass-border);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .inventory-item img {
            width: 140px;
            height: 105px;
            object-fit: contain;
        }

        .item-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-active {
            background: linear-gradient(45deg, rgba(0, 184, 148, 0.2), rgba(85, 239, 196, 0.1));
            color: #00b894;
            border: 1px solid #00b894;
        }

        .status-sold {
            background: linear-gradient(45deg, rgba(255, 0, 84, 0.2), rgba(255, 64, 102, 0.1));
            color: var(--red-color);
            border: 1px solid var(--red-color);
        }

        /* Апгрейд и контракты страницы */
        .upgrade-page, .contracts-page {
            display: none;
        }

        .upgrade-page.active, .contracts-page.active {
            display: block;
        }

        .page-content {
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 40px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            text-align: center;
        }

        .page-content h2 {
            font-size: 36px;
            margin-bottom: 20px;
            color: var(--light-color);
        }

        .page-content p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 18px;
            line-height: 1.6;
        }

        /* Футер */
        footer {
            background: linear-gradient(180deg, transparent, rgba(36, 0, 70, 0.9));
            padding: 50px 0;
            border-top: 1px solid var(--glass-border);
            margin-top: 80px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .footer-logo {
            font-size: 26px;
            font-weight: 800;
            color: var(--light-color);
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-logo span {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .footer-links {
            display: flex;
            gap: 35px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
        }

        .footer-links a:hover {
            color: var(--primary-color);
            background: rgba(157, 78, 221, 0.1);
        }

        .copyright {
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            text-align: center;
            max-width: 700px;
            line-height: 1.6;
        }

        /* Адаптивность */
        @media (max-width: 1200px) {
            main {
                flex-direction: column;
            }
            
            .drops-sidebar {
                width: 100%;
                order: 2;
                position: static;
            }
            
            .drops-list {
                height: 300px;
                flex-direction: row;
                overflow-x: auto;
            }
            
            .drop-item {
                min-width: 320px;
                animation: none !important;
                position: static !important;
                opacity: 1 !important;
                margin-bottom: 0;
            }
            
            .profile-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            nav ul {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .page-title {
                font-size: 40px;
            }
            
            .cases-grid {
                grid-template-columns: 1fr;
            }
            
            .case-opening-section {
                padding: 25px;
            }
            
            .scroll-item {
                width: 200px;
                height: 220px;
            }
            
            .admin-btn {
                top: 15px;
                left: 15px;
            }
            
            .spin-btn {
                padding: 18px 40px;
                font-size: 18px;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 32px;
            }
            
            .section-title {
                font-size: 26px;
            }
            
            .item-name {
                font-size: 28px;
            }
            
            .profile-stat {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .inventory-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Утилиты */
        .gradient-text {
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color), var(--red-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }

        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Счетчик онлайн */
        .online-counter {
            animation: onlinePulse 3s infinite;
        }

        @keyframes onlinePulse {
            0% { box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3); }
            50% { box-shadow: 0 4px 25px rgba(0, 184, 148, 0.5); }
            100% { box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 9999;
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <!-- Кнопка админ-панели -->
    <button class="admin-btn" id="admin-btn" title="Админ панель">
        <i class="fas fa-cog"></i>
    </button>

    <!-- Шапка -->
    <header>
        <div class="container header-content">
            <div class="logo" id="logo">
                <i class="fas fa-gem"></i>
                Case<span>Wins</span>
                <div class="online-counter" id="online-counter">
                    <i class="fas fa-users"></i>
                    <span id="online-count">1,247</span>
                </div>
            </div>
            
            <nav>
                <ul>
                    <li><a href="#" id="home-tab" class="active"><i class="fas fa-home"></i> Главная</a></li>
                    <li><a href="#" id="cases-tab"><i class="fas fa-box-open"></i> Кейсы</a></li>
                    <li><a href="#" id="upgrade-tab"><i class="fas fa-level-up-alt"></i> Апгрейд</a></li>
                    <li><a href="#" id="contracts-tab"><i class="fas fa-file-contract"></i> Контракты</a></li>
                </ul>
            </nav>
            
            <div class="header-right">
                <div class="user-info">
                    <div class="balance">
                        <i class="fas fa-coins"></i>
                        <span id="user-balance">0</span>
                    </div>
                    
                    <div class="user-avatar" id="user-avatar-btn">
                        <span id="user-initials">G</span>
                    </div>
                    <button class="logout-header-btn" id="logout-header-btn" style="display: none;">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Основной контент -->
    <main class="container">
        <!-- Боковая панель с недавними дропами -->
        <aside class="drops-sidebar">
            <h3 class="drops-title">
                <i class="fas fa-history"></i> Недавний дроп
            </h3>
            <div class="drops-list">
                <div class="drops-container" id="drops-container">
                    <!-- История выпадений будет добавляться динамически -->
                </div>
            </div>
        </aside>
        
        <!-- Секция кейсов (главная страница) -->
        <div class="main-content" id="cases-page">
            <h1 class="page-title">Открой <span class="gradient-text">кейсы CS2</span> и выиграй <span class="gradient-text">скины</span></h1>
            
            <!-- Секция открытия кейса (скрыта по умолчанию) -->
            <section class="case-opening-section" id="case-opening-section">
                <div class="opening-header">
                    <div class="opening-title">
                        <i class="fas fa-box-open"></i>
                        <span id="opening-case-name">Армейский кейс</span>
                    </div>
                    <button class="close-opening" id="close-opening">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="case-opening-container">
                    <div class="selection-indicator"></div>
                    <button class="center-open-btn" id="center-open-btn">
                        <i class="fas fa-box-open"></i> Открыть кейс
                    </button>
                    <div class="case-items-scroll" id="case-items-scroll">
                        <!-- Предметы будут добавляться динамически -->
                    </div>
                </div>
                
                <div class="case-opening-controls">
                    <button class="spin-btn" id="spin-btn">
                        <i class="fas fa-play"></i> Открыть за <span id="spin-price">1,500</span>
                    </button>
                </div>
                
                <div class="items-preview" id="items-preview">
                    <!-- Предметы из кейса будут отображаться здесь -->
                </div>
            </section>
            
            <!-- Секция выбора кейсов -->
            <section class="case-selection" id="case-selection">
                <h2 class="section-title">
                    <i class="fas fa-gem"></i> Доступные кейсы
                </h2>
                
                <div class="cases-grid">
                    <!-- Армейский кейс (синие скины) -->
                    <div class="case-card" data-case="1">
                        <div class="case-image">
                            <img src="https://via.placeholder.com/300x200/4c6ef4/ffffff?text=Army+Case" alt="Армейский кейс">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Армейский кейс</div>
                            <div class="case-price">
                                <i class="fas fa-coins"></i> 
                                <span class="case-price-value">1,500</span>
                            </div>
                            <div class="case-items">
                                <span>15 предметов</span>
                                <span>Легендарка: 1%</span>
                            </div>
                            <div class="open-case-section">
                                <button class="open-case-btn" data-case="1" disabled>
                                    <i class="fas fa-lock"></i> Войдите для открытия
                                </button>
                                <div class="case-stats">
                                    <div class="stat"><i class="fas fa-box-open"></i> 15 предметов</div>
                                    <div class="stat"><i class="fas fa-crown"></i> 1% шанс</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Запрещенный кейс (фиолетовые скины) -->
                    <div class="case-card" data-case="2">
                        <div class="case-image">
                            <img src="https://via.placeholder.com/300x200/b6509b/ffffff?text=Contraband+Case" alt="Запрещенный кейс">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Запрещенный кейс</div>
                            <div class="case-price">
                                <i class="fas fa-coins"></i> 
                                <span class="case-price-value">2,500</span>
                            </div>
                            <div class="case-items">
                                <span>12 предметов</span>
                                <span>Легендарка: 2%</span>
                            </div>
                            <div class="open-case-section">
                                <button class="open-case-btn" data-case="2" disabled>
                                    <i class="fas fa-lock"></i> Войдите для открытия
                                </button>
                                <div class="case-stats">
                                    <div class="stat"><i class="fas fa-box-open"></i> 12 предметов</div>
                                    <div class="stat"><i class="fas fa-crown"></i> 2% шанс</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Засекреченный кейс (розовые скины) -->
                    <div class="case-card" data-case="3">
                        <div class="case-image">
                            <img src="https://via.placeholder.com/300x200/ff6b9d/ffffff?text=Classified+Case" alt="Засекреченный кейс">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Засекреченный кейс</div>
                            <div class="case-price">
                                <i class="fas fa-coins"></i> 
                                <span class="case-price-value">4,000</span>
                            </div>
                            <div class="case-items">
                                <span>10 предметов</span>
                                <span>Легендарка: 3%</span>
                            </div>
                            <div class="open-case-section">
                                <button class="open-case-btn" data-case="3" disabled>
                                    <i class="fas fa-lock"></i> Войдите для открытия
                                </button>
                                <div class="case-stats">
                                    <div class="stat"><i class="fas fa-box-open"></i> 10 предметов</div>
                                    <div class="stat"><i class="fas fa-crown"></i> 3% шанс</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Тайный кейс (красные скины) -->
                    <div class="case-card" data-case="4">
                        <div class="case-image">
                            <img src="https://via.placeholder.com/300x200/eb4b4b/ffffff?text=Covert+Case" alt="Тайный кейс">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Тайный кейс</div>
                            <div class="case-price">
                                <i class="fas fa-coins"></i> 
                                <span class="case-price-value">6,000</span>
                            </div>
                            <div class="case-items">
                                <span>8 предметов</span>
                                <span>Легендарка: 5%</span>
                            </div>
                            <div class="open-case-section">
                                <button class="open-case-btn" data-case="4" disabled>
                                    <i class="fas fa-lock"></i> Войдите для открытия
                                </button>
                                <div class="case-stats">
                                    <div class="stat"><i class="fas fa-box-open"></i> 8 предметов</div>
                                    <div class="stat"><i class="fas fa-crown"></i> 5% шанс</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ножевой кейс (желтые скины) -->
                    <div class="case-card" data-case="5">
                        <div class="case-image">
                            <img src="https://via.placeholder.com/300x200/ffd700/333333?text=Knife+Case" alt="Ножевой кейс">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Ножевой кейс</div>
                            <div class="case-price">
                                <i class="fas fa-coins"></i> 
                                <span class="case-price-value">10,000</span>
                            </div>
                            <div class="case-items">
                                <span>6 предметов</span>
                                <span>Легендарка: 10%</span>
                            </div>
                            <div class="open-case-section">
                                <button class="open-case-btn" data-case="5" disabled>
                                    <i class="fas fa-lock"></i> Войдите для открытия
                                </button>
                                <div class="case-stats">
                                    <div class="stat"><i class="fas fa-box-open"></i> 6 предметов</div>
                                    <div class="stat"><i class="fas fa-crown"></i> 10% шанс</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Страница профиля -->
        <div class="profile-page" id="profile-page">
            <div class="profile-header">
                <button class="profile-back-btn" id="profile-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад к кейсам
                </button>
                <div class="balance">
                    <i class="fas fa-coins"></i>
                    <span id="profile-page-balance">0</span>
                </div>
            </div>
            
            <div class="profile-content">
                <div class="profile-sidebar">
                    <div class="profile-avatar" id="profile-page-avatar">
                        <span id="profile-page-initials">G</span>
                    </div>
                    <div class="profile-info">
                        <h2 id="profile-page-name">Гость</h2>
                        <div class="profile-stats">
                            <div class="profile-stat">
                                <span><i class="fas fa-box-open"></i> Открыто кейсов:</span>
                                <span id="profile-page-cases">0</span>
                            </div>
                            <div class="profile-stat">
                                <span><i class="fas fa-chart-line"></i> Общая стоимость:</span>
                                <span id="profile-page-total">0</span>
                            </div>
                            <div class="profile-stat">
                                <span><i class="fas fa-crown"></i> Лучший предмет:</span>
                                <span id="profile-page-best">Нет</span>
                            </div>
                            <div class="profile-stat">
                                <span><i class="fas fa-calendar"></i> Аккаунт создан:</span>
                                <span id="profile-page-created">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-main">
                    <h2 style="margin-bottom: 20px; color: var(--light-color);">Инвентарь</h2>
                    
                    <div class="inventory-filters">
                        <button class="filter-btn active" data-filter="all">Все предметы</button>
                        <button class="filter-btn" data-filter="active">Активные</button>
                        <button class="filter-btn" data-filter="sold">Проданные</button>
                    </div>
                    
                    <div class="inventory-grid" id="inventory-grid">
                        <!-- Инвентарь будет загружаться здесь -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Страница апгрейда -->
        <div class="profile-page" id="upgrade-page">
            <div class="profile-header">
                <button class="profile-back-btn" id="upgrade-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад к кейсам
                </button>
                <h2 style="color: var(--light-color);">Система апгрейда</h2>
            </div>
            
            <div class="page-content">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;">Скоро будет доступно!</h3>
                <p style="color: rgba(255,255,255,0.7);">Система апгрейда находится в разработке</p>
            </div>
        </div>

        <!-- Страница контрактов -->
        <div class="profile-page" id="contracts-page">
            <div class="profile-header">
                <button class="profile-back-btn" id="contracts-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад к кейсам
                </button>
                <h2 style="color: var(--light-color);">Контракты</h2>
            </div>
            
            <div class="page-content">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;">Скоро будет доступно!</h3>
                <p style="color: rgba(255,255,255,0.7);">Система контрактов находится в разработке</p>
            </div>
        </div>
    </main>
    
    <!-- Модальное окно с результатом -->
    <div class="modal" id="result-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="gradient-text">Поздравляем!</span>
                <button class="close-modal-btn" id="close-result-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="text-align: center; font-size: 20px; margin-bottom: 25px;">Вы открыли кейс и получаете:</p>
                
                <div class="won-item">
                    <div class="item-image">
                        <img id="won-item-img" src="https://via.placeholder.com/300x200/4c6ef4/ffffff?text=AK-47+Blue+Laminate" alt="Выигранный предмет">
                    </div>
                    <div class="item-name" id="won-item-name">AK-47 | Синий ламинат</div>
                    <div class="item-price" id="won-item-price">Цена: 400 <i class="fas fa-coins"></i></div>
                    <div class="item-rarity rarity-rare" id="won-item-rarity">Редкий</div>
                </div>
                
                <div class="modal-actions">
                    <button class="modal-btn sell-btn" id="sell-item-btn">
                        <i class="fas fa-money-bill-wave"></i> Продать
                    </button>
                    <button class="modal-btn open-again" id="open-again-btn">
                        <i class="fas fa-redo"></i> Открыть еще
                    </button>
                    <button class="modal-btn close-modal" id="close-modal-btn">
                        <i class="fas fa-times"></i> Выйти
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Админ-панель -->
    <div class="modal" id="admin-modal">
        <div class="admin-panel">
            <div class="modal-header">
                <span class="gradient-text">Админ панель</span>
                <button class="close-modal-btn" id="close-admin-modal">&times;</button>
            </div>
            <div class="admin-form">
                <div class="form-group">
                    <label for="admin-password">Пароль администратора</label>
                    <input type="password" id="admin-password" placeholder="Введите пароль">
                </div>
                
                <div id="admin-content" style="display: none;">
                    <h3 style="margin-bottom: 30px; text-align: center; color: var(--primary-color);">Настройки системы</h3>
                    
                    <div class="form-group">
                        <label for="admin-balance">Баланс пользователя</label>
                        <input type="number" id="admin-balance" value="12540">
                    </div>
                    
                    <div class="form-group">
                        <label>Цены кейсов</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                            <input type="number" id="admin-case1-price" value="1500" placeholder="Армейский">
                            <input type="number" id="admin-case2-price" value="2500" placeholder="Запрещенный">
                            <input type="number" id="admin-case3-price" value="4000" placeholder="Засекреченный">
                            <input type="number" id="admin-case4-price" value="6000" placeholder="Тайный">
                            <input type="number" id="admin-case5-price" value="10000" placeholder="Ножевой">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Чат поддержки</label>
                        <div class="support-chat">
                            <div class="chat-messages" id="admin-chat-messages">
                                <!-- Сообщения поддержки будут здесь -->
                            </div>
                            <div class="chat-input-area">
                                <input type="text" id="admin-chat-input" placeholder="Введите ответ...">
                                <button id="admin-chat-send">Отправить</button>
                            </div>
                        </div>
                        <div class="support-actions" style="display: none;" id="admin-chat-actions">
                            <button class="admin-btn-submit" id="resolve-chat-btn">
                                <i class="fas fa-check"></i> Вопрос решен
                            </button>
                            <button class="admin-btn-cancel" id="close-chat-btn">
                                <i class="fas fa-times"></i> Закрыть чат
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-actions">
                        <button class="admin-btn-submit" id="admin-save-btn">
                            <i class="fas fa-save"></i> Сохранить
                        </button>
                        <button class="admin-btn-cancel" id="admin-cancel-btn">
                            <i class="fas fa-times"></i> Отмена
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Окно авторизации -->
    <div class="modal" id="auth-modal">
        <div class="admin-panel">
            <div class="modal-header">
                <span class="gradient-text">Вход в систему</span>
                <button class="close-modal-btn" id="close-auth-modal">&times;</button>
            </div>
            <div class="admin-form">
                <div class="auth-tabs" style="display: flex; margin-bottom: 30px; border-radius: 12px; overflow: hidden; background: rgba(0,0,0,0.2);">
                    <div class="auth-tab active" id="login-tab" style="flex: 1; text-align: center; padding: 15px; cursor: pointer; background: linear-gradient(45deg, var(--primary-color), var(--purple-color)); color: white; font-weight: 700;">Вход</div>
                    <div class="auth-tab" id="register-tab" style="flex: 1; text-align: center; padding: 15px; cursor: pointer; background: rgba(0,0,0,0.3); color: rgba(255,255,255,0.7); font-weight: 700;">Регистрация</div>
                </div>
                
                <!-- Форма входа -->
                <div id="login-form">
                    <div class="form-group">
                        <label for="login-username">Логин</label>
                        <input type="text" id="login-username" placeholder="Введите логин">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Пароль</label>
                        <input type="password" id="login-password" placeholder="Введите пароль">
                    </div>
                    
                    <button class="admin-btn-submit" id="login-btn" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Войти
                    </button>
                </div>
                
                <!-- Форма регистрации -->
                <div id="register-form" style="display: none;">
                    <div class="form-group">
                        <label for="register-username">Логин</label>
                        <input type="text" id="register-username" placeholder="Придумайте логин (мин. 3 символа)">
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password">Пароль</label>
                        <input type="password" id="register-password" placeholder="Придумайте пароль (мин. 6 символов)">
                    </div>
                    
                    <div class="form-group">
                        <label for="register-confirm">Подтвердите пароль</label>
                        <input type="password" id="register-confirm" placeholder="Повторите пароль">
                    </div>
                    
                    <button class="admin-btn-submit" id="register-btn" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Зарегистрироваться
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Чат поддержки -->
    <div class="modal" id="support-modal">
        <div class="admin-panel">
            <div class="modal-header">
                <span class="gradient-text">Поддержка</span>
                <button class="close-modal-btn" id="close-support-modal">&times;</button>
            </div>
            <div class="admin-form">
                <div class="support-chat">
                    <div class="chat-messages" id="support-chat-messages">
                        <!-- Сообщения чата будут здесь -->
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="support-chat-input" placeholder="Введите ваш вопрос...">
                        <button id="support-chat-send">Отправить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Футер -->
    <footer>
        <div class="container footer-content">
            <div class="footer-logo">
                <i class="fas fa-gem"></i>
                Case<span>Wins</span>
            </div>
            
            <div class="footer-links">
                <a href="#" id="footer-home"><i class="fas fa-home"></i> Главная</a>
                <a href="#" id="footer-cases"><i class="fas fa-box-open"></i> Кейсы</a>
                <a href="#" id="footer-upgrade"><i class="fas fa-level-up-alt"></i> Апгрейд</a>
                <a href="#" id="footer-contracts"><i class="fas fa-file-contract"></i> Контракты</a>
                <a href="#" id="footer-support"><i class="fas fa-headset"></i> Поддержка</a>
            </div>
            
            <div class="copyright">
                © 2023 CaseWins. Все права защищены. Сайт предназначен для развлекательных целей.
                CS:GO и Counter-Strike: Global Offensive являются товарными знаками корпорации Valve.
            </div>
        </div>
    </footer>

    <script>
    // База данных для пользователей (хранится в localStorage)
    let usersDatabase = {
        // Администратор по умолчанию
        "admin": {
            password: "admin123",
            balance: 12540,
            casesOpened: 0,
            totalValue: 0,
            bestItem: "Нет",
            createdAt: new Date().toLocaleDateString(),
            isAdmin: true,
            inventory: [],
            supportChat: []
        },
        "k1lame": {
            password: "k1lame1234",
            balance: 12540,
            casesOpened: 0,
            totalValue: 0,
            bestItem: "Нет",
            createdAt: new Date().toLocaleDateString(),
            isAdmin: true,
            inventory: [],
            supportChat: []
        }
    };

    // База данных для сообщений поддержки
    let supportDatabase = {};

    // Данные о скинах по цветам
    const skinData = {
        blue: [
            { name: "AK-47 | Синий ламинат", value: 400, img: "https://via.placeholder.com/300x200/4c6ef4/ffffff?text=AK-47+Blue+Laminate" },
            { name: "M4A4 | Синий тигр", value: 350, img: "https://via.placeholder.com/300x200/4c6ef4/ffffff?text=M4A4+Blue+Tiger" },
            { name: "AWP | Синяя линия", value: 500, img: "https://via.placeholder.com/300x200/4c6ef4/ffffff?text=AWP+Blue+Line" },
            { name: "Desert Eagle | Синий", value: 300, img: "https://via.placeholder.com/300x200/4c6ef4/ffffff?text=Deagle+Blue" },
            { name: "Glock-18 | Синяя трещина", value: 250, img: "https://via.placeholder.com/300x200/4c6ef4/ffffff?text=Glock+Blue+Fissure" }
        ],
        
        purple: [
            { name: "AK-47 | Фиолетовый градиент", value: 800, img: "https://via.placeholder.com/300x200/b6509b/ffffff?text=AK-47+Purple+Gradient" },
            { name: "M4A1-S | Фиолетовая ночь", value: 750, img: "https://via.placeholder.com/300x200/b6509b/ffffff?text=M4A1-S+Purple+Night" },
            { name: "AWP | Фиолетовая линия", value: 900, img: "https://via.placeholder.com/300x200/b6509b/ffffff?text=AWP+Purple+Line" },
            { name: "Desert Eagle | Фиолетовый", value: 600, img: "https://via.placeholder.com/300x200/b6509b/ffffff?text=Deagle+Purple" }
        ],
        
        pink: [
            { name: "AK-47 | Розовый градиент", value: 1500, img: "https://via.placeholder.com/300x200/ff6b9d/ffffff?text=AK-47+Pink+Gradient" },
            { name: "M4A4 | Розовая ночь", value: 1400, img: "https://via.placeholder.com/300x200/ff6b9d/ffffff?text=M4A4+Pink+Night" },
            { name: "AWP | Розовая линия", value: 1800, img: "https://via.placeholder.com/300x200/ff6b9d/ffffff?text=AWP+Pink+Line" }
        ],
        
        red: [
            { name: "AK-47 | Красный градиент", value: 3000, img: "https://via.placeholder.com/300x200/eb4b4b/ffffff?text=AK-47+Red+Gradient" },
            { name: "M4A1-S | Красная ночь", value: 2800, img: "https://via.placeholder.com/300x200/eb4b4b/ffffff?text=M4A1-S+Red+Night" },
            { name: "AWP | Красная линия", value: 3500, img: "https://via.placeholder.com/300x200/eb4b4b/ffffff?text=AWP+Red+Line" }
        ],
        
        yellow: [
            { name: "Нож | Сапфир", value: 8000, img: "https://via.placeholder.com/300x200/ffd700/333333?text=Knife+Sapphire" },
            { name: "Нож | Рубин", value: 7500, img: "https://via.placeholder.com/300x200/ffd700/333333?text=Knife+Ruby" },
            { name: "Нож | Изумруд", value: 7000, img: "https://via.placeholder.com/300x200/ffd700/333333?text=Knife+Emerald" }
        ]
    };

    // Данные о кейсах
    const casesData = {
        1: {
            name: "Армейский кейс",
            price: 1500,
            legendaryChance: 1,
            color: 'blue',
            items: skinData.blue
        },
        2: {
            name: "Запрещенный кейс",
            price: 2500,
            legendaryChance: 2,
            color: 'purple',
            items: skinData.purple
        },
        3: {
            name: "Засекреченный кейс",
            price: 4000,
            legendaryChance: 3,
            color: 'pink',
            items: skinData.pink
        },
        4: {
            name: "Тайный кейс",
            price: 6000,
            legendaryChance: 5,
            color: 'red',
            items: skinData.red
        },
        5: {
            name: "Ножевой кейс",
            price: 10000,
            legendaryChance: 10,
            color: 'yellow',
            items: skinData.yellow
        }
    };

    // Текущий пользователь
    let currentUser = null;

    // Текущее состояние
    const gameState = {
        selectedCase: null,
        isSpinning: false,
        spinResult: null,
        recentDrops: [],
        onlineUsers: 1247,
        currentPage: 'cases'
    };

    // DOM элементы
    const adminBtn = document.getElementById('admin-btn');
    const userBalanceSpan = document.getElementById('user-balance');
    const userAvatarBtn = document.getElementById('user-avatar-btn');
    const userInitials = document.getElementById('user-initials');
    const logoutHeaderBtn = document.getElementById('logout-header-btn');
    const onlineCounter = document.getElementById('online-counter');
    const onlineCount = document.getElementById('online-count');
    const logo = document.getElementById('logo');
    const caseCards = document.querySelectorAll('.case-card');
    const openCaseButtons = document.querySelectorAll('.open-case-btn');
    const caseOpeningSection = document.getElementById('case-opening-section');
    const closeOpeningBtn = document.getElementById('close-opening');
    const spinBtn = document.getElementById('spin-btn');
    const centerOpenBtn = document.getElementById('center-open-btn');
    const spinPriceSpan = document.getElementById('spin-price');
    const openingCaseName = document.getElementById('opening-case-name');
    const caseItemsScroll = document.getElementById('case-items-scroll');
    const itemsPreview = document.getElementById('items-preview');
    const caseSelection = document.getElementById('case-selection');
    
    // Навигация
    const homeTab = document.getElementById('home-tab');
    const casesTab = document.getElementById('cases-tab');
    const upgradeTab = document.getElementById('upgrade-tab');
    const contractsTab = document.getElementById('contracts-tab');
    
    // Страницы
    const casesPage = document.getElementById('cases-page');
    const profilePage = document.getElementById('profile-page');
    const upgradePage = document.getElementById('upgrade-page');
    const contractsPage = document.getElementById('contracts-page');
    
    // Профиль
    const profileBackBtn = document.getElementById('profile-back-btn');
    const profilePageBalance = document.getElementById('profile-page-balance');
    const profilePageAvatar = document.getElementById('profile-page-avatar');
    const profilePageInitials = document.getElementById('profile-page-initials');
    const profilePageName = document.getElementById('profile-page-name');
    const profilePageCases = document.getElementById('profile-page-cases');
    const profilePageTotal = document.getElementById('profile-page-total');
    const profilePageBest = document.getElementById('profile-page-best');
    const profilePageCreated = document.getElementById('profile-page-created');
    const inventoryGrid = document.getElementById('inventory-grid');
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    // Апгрейд и контракты
    const upgradeBackBtn = document.getElementById('upgrade-back-btn');
    const contractsBackBtn = document.getElementById('contracts-back-btn');
    
    // Модальные окна
    const resultModal = document.getElementById('result-modal');
    const closeResultModalBtn = document.getElementById('close-result-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const openAgainBtn = document.getElementById('open-again-btn');
    const sellItemBtn = document.getElementById('sell-item-btn');
    const wonItemImg = document.getElementById('won-item-img');
    const wonItemName = document.getElementById('won-item-name');
    const wonItemPrice = document.getElementById('won-item-price');
    const wonItemRarity = document.getElementById('won-item-rarity');
    
    // Авторизация
    const authModal = document.getElementById('auth-modal');
    const closeAuthModalBtn = document.getElementById('close-auth-modal');
    const loginTab = document.getElementById('login-tab');
    const registerTab = document.getElementById('register-tab');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const loginBtn = document.getElementById('login-btn');
    const registerBtn = document.getElementById('register-btn');
    const loginUsername = document.getElementById('login-username');
    const loginPassword = document.getElementById('login-password');
    const registerUsername = document.getElementById('register-username');
    const registerPassword = document.getElementById('register-password');
    const registerConfirm = document.getElementById('register-confirm');
    
    // Админ панель
    const adminModal = document.getElementById('admin-modal');
    const closeAdminModalBtn = document.getElementById('close-admin-modal');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminContent = document.getElementById('admin-content');
    const adminBalanceInput = document.getElementById('admin-balance');
    const adminCase1PriceInput = document.getElementById('admin-case1-price');
    const adminCase2PriceInput = document.getElementById('admin-case2-price');
    const adminCase3PriceInput = document.getElementById('admin-case3-price');
    const adminCase4PriceInput = document.getElementById('admin-case4-price');
    const adminCase5PriceInput = document.getElementById('admin-case5-price');
    const adminChatMessages = document.getElementById('admin-chat-messages');
    const adminChatInput = document.getElementById('admin-chat-input');
    const adminChatSend = document.getElementById('admin-chat-send');
    const adminChatActions = document.getElementById('admin-chat-actions');
    const resolveChatBtn = document.getElementById('resolve-chat-btn');
    const closeChatBtn = document.getElementById('close-chat-btn');
    const adminSaveBtn = document.getElementById('admin-save-btn');
    const adminCancelBtn = document.getElementById('admin-cancel-btn');
    
    // Чат поддержки
    const supportModalElement = document.getElementById('support-modal');
    const closeSupportModalBtn = document.getElementById('close-support-modal');
    const supportChatMessages = document.getElementById('support-chat-messages');
    const supportChatInput = document.getElementById('support-chat-input');
    const supportChatSend = document.getElementById('support-chat-send');
    
    // Футер ссылки
    const footerHome = document.getElementById('footer-home');
    const footerCases = document.getElementById('footer-cases');
    const footerUpgrade = document.getElementById('footer-upgrade');
    const footerContracts = document.getElementById('footer-contracts');
    const footerSupport = document.getElementById('footer-support');
    
    // История дропов
    const dropsContainer = document.getElementById('drops-container');

    // Инициализация
    function init() {
        console.log('Инициализация сайта...');
        
        // Загружаем базы данных из localStorage
        loadDatabases();
        
        // Проверяем сохраненного пользователя
        checkSavedUser();
        
        // Обновляем счетчик онлайн
        updateOnlineCounter();
        setInterval(updateOnlineCounter, 30000);
        
        // Загружаем историю выпадений
        loadRecentDrops();
        startDropAnimation();
        
        // Инициализируем обработчики событий
        initEventListeners();
        
        // Обновляем кнопки открытия кейсов
        updateOpenCaseButtons();
        
        console.log('Инициализация завершена');
    }

    // Загрузка баз данных из localStorage
    function loadDatabases() {
        console.log('Загрузка баз данных...');
        const savedUsers = localStorage.getItem('casewins_users_database');
        const savedSupport = localStorage.getItem('casewins_support_database');
        
        if (savedUsers) {
            usersDatabase = JSON.parse(savedUsers);
            console.log('База пользователей загружена:', Object.keys(usersDatabase).length, 'пользователей');
        } else {
            saveDatabases();
        }
        
        if (savedSupport) {
            supportDatabase = JSON.parse(savedSupport);
            console.log('База поддержки загружена');
        }
    }

    // Сохранение баз данных в localStorage
    function saveDatabases() {
        localStorage.setItem('casewins_users_database', JSON.stringify(usersDatabase));
        localStorage.setItem('casewins_support_database', JSON.stringify(supportDatabase));
        console.log('Базы данных сохранены');
    }

    // Проверка сохраненного пользователя
    function checkSavedUser() {
        console.log('Проверка сохраненного пользователя...');
        const savedUser = localStorage.getItem('casewins_current_user');
        if (savedUser) {
            try {
                const userData = JSON.parse(savedUser);
                console.log('Найден сохраненный пользователь:', userData.username);
                if (userData.username && usersDatabase[userData.username]) {
                    currentUser = userData.username;
                    updateUserDisplay();
                    updateProfilePage();
                    console.log('Пользователь восстановлен:', currentUser);
                }
            } catch (e) {
                console.error('Ошибка восстановления пользователя:', e);
            }
        }
    }

    // Сохранение текущего пользователя
    function saveCurrentUser() {
        if (currentUser && usersDatabase[currentUser]) {
            const userData = {
                username: currentUser,
                lastLogin: new Date().toISOString()
            };
            localStorage.setItem('casewins_current_user', JSON.stringify(userData));
            console.log('Текущий пользователь сохранен:', currentUser);
        } else {
            localStorage.removeItem('casewins_current_user');
        }
    }

    // Обновление счетчика онлайн
    function updateOnlineCounter() {
        const baseCount = 1247;
        const randomChange = Math.floor(Math.random() * 50) - 25;
        const newCount = Math.max(1000, baseCount + randomChange);
        gameState.onlineUsers = newCount;
        onlineCount.textContent = newCount.toLocaleString();
    }

    // Инициализация обработчиков событий
    function initEventListeners() {
        console.log('Инициализация обработчиков событий...');
        
        // Навигация
        logo.addEventListener('click', () => {
            showPage('cases');
            setActiveTab(homeTab);
        });
        
        homeTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('cases');
            setActiveTab(homeTab);
        });
        
        casesTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('cases');
            setActiveTab(casesTab);
        });
        
        upgradeTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('upgrade');
            setActiveTab(upgradeTab);
        });
        
        contractsTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('contracts');
            setActiveTab(contractsTab);
        });
        
        // Кнопки назад
        profileBackBtn.addEventListener('click', () => {
            showPage('cases');
            setActiveTab(homeTab);
        });
        
        upgradeBackBtn.addEventListener('click', () => {
            showPage('cases');
            setActiveTab(homeTab);
        });
        
        contractsBackBtn.addEventListener('click', () => {
            showPage('cases');
            setActiveTab(homeTab);
        });
        
        // Футер навигация
        footerHome.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('cases');
            setActiveTab(homeTab);
        });
        
        footerCases.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('cases');
            setActiveTab(casesTab);
        });
        
        footerUpgrade.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('upgrade');
            setActiveTab(upgradeTab);
        });
        
        footerContracts.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('contracts');
            setActiveTab(contractsTab);
        });
        
        footerSupport.addEventListener('click', (e) => {
            e.preventDefault();
            showSupportModal();
        });
        
        // Выбор кейса
        caseCards.forEach(card => {
            card.addEventListener('click', function() {
                const caseId = parseInt(this.dataset.case);
                openCaseView(caseId);
            });
        });
        
        // Кнопки открытия кейсов
        openCaseButtons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const caseId = parseInt(this.dataset.case);
                openCase(caseId);
            });
        });
        
        // Центральная кнопка открытия кейса
        centerOpenBtn.addEventListener('click', () => {
            if (gameState.selectedCase) {
                openCase(gameState.selectedCase);
            }
        });
        
        // Закрытие окна открытия кейса
        closeOpeningBtn.addEventListener('click', () => {
            caseOpeningSection.classList.remove('active');
            caseSelection.style.display = 'block';
        });
        
        // Кнопка прокрутки
        spinBtn.addEventListener('click', spinCase);
        
        // Фильтры инвентаря
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                filterButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                filterInventory(this.dataset.filter);
            });
        });
        
        // Модальное окно результата
        closeModalBtn.addEventListener('click', () => {
            resultModal.style.display = 'none';
        });
        
        closeResultModalBtn.addEventListener('click', () => {
            resultModal.style.display = 'none';
        });
        
        openAgainBtn.addEventListener('click', () => {
            resultModal.style.display = 'none';
            if (gameState.selectedCase) {
                openCase(gameState.selectedCase);
            }
        });
        
        sellItemBtn.addEventListener('click', sellWonItem);
        
        // Аватар пользователя - ОСНОВНОЙ ИСПРАВЛЕНИЕ
        userAvatarBtn.addEventListener('click', () => {
            console.log('Аватар нажат, текущий пользователь:', currentUser);
            if (!currentUser) {
                console.log('Пользователь не авторизован, открываем авторизацию');
                authModal.style.display = 'flex';
            } else {
                console.log('Пользователь авторизован, открываем профиль');
                showPage('profile');
            }
        });
        
        logoutHeaderBtn.addEventListener('click', logout);
        
        closeAuthModalBtn.addEventListener('click', () => {
            authModal.style.display = 'none';
        });
        
        loginTab.addEventListener('click', () => {
            loginTab.style.background = 'linear-gradient(45deg, var(--primary-color), var(--purple-color))';
            loginTab.style.color = 'white';
            registerTab.style.background = 'rgba(0,0,0,0.3)';
            registerTab.style.color = 'rgba(255,255,255,0.7)';
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
        });
        
        registerTab.addEventListener('click', () => {
            registerTab.style.background = 'linear-gradient(45deg, var(--primary-color), var(--purple-color))';
            registerTab.style.color = 'white';
            loginTab.style.background = 'rgba(0,0,0,0.3)';
            loginTab.style.color = 'rgba(255,255,255,0.7)';
            registerForm.style.display = 'block';
            loginForm.style.display = 'none';
        });
        
        loginBtn.addEventListener('click', login);
        registerBtn.addEventListener('click', register);
        
        // Авторизация по нажатию Enter
        loginUsername.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') login();
        });
        
        loginPassword.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') login();
        });
        
        registerUsername.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') register();
        });
        
        registerPassword.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') register();
        });
        
        registerConfirm.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') register();
        });
        
        // Админ панель
        adminBtn.addEventListener('click', () => {
            adminModal.style.display = 'flex';
            adminPasswordInput.value = '';
            adminContent.style.display = 'none';
        });
        
        closeAdminModalBtn.addEventListener('click', () => {
            adminModal.style.display = 'none';
        });
        
        adminPasswordInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                checkAdminPassword();
            }
        });
        
        adminChatSend.addEventListener('click', sendAdminMessage);
        adminChatInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') sendAdminMessage();
        });
        
        resolveChatBtn.addEventListener('click', resolveSupportChat);
        closeChatBtn.addEventListener('click', closeSupportChat);
        
        adminSaveBtn.addEventListener('click', saveAdminSettings);
        adminCancelBtn.addEventListener('click', () => {
            adminModal.style.display = 'none';
        });
        
        // Чат поддержки
        closeSupportModalBtn.addEventListener('click', () => {
            supportModalElement.style.display = 'none';
        });
        
        supportChatSend.addEventListener('click', sendSupportMessage);
        supportChatInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') sendSupportMessage();
        });
        
        console.log('Обработчики событий инициализированы');
    }

    // Показать страницу
    function showPage(page) {
        console.log('Показать страницу:', page);
        
        // Скрываем все страницы
        casesPage.style.display = 'none';
        profilePage.classList.remove('active');
        upgradePage.classList.remove('active');
        contractsPage.classList.remove('active');
        caseOpeningSection.classList.remove('active');
        caseSelection.style.display = 'block';
        
        // Показываем выбранную страницу
        gameState.currentPage = page;
        
        switch(page) {
            case 'cases':
                casesPage.style.display = 'block';
                break;
            case 'profile':
                if (!currentUser) {
                    console.log('Пользователь не авторизован, открываем авторизацию');
                    authModal.style.display = 'flex';
                    return;
                }
                console.log('Открываем профиль пользователя:', currentUser);
                updateProfilePage();
                profilePage.classList.add('active');
                break;
            case 'upgrade':
                upgradePage.classList.add('active');
                break;
            case 'contracts':
                contractsPage.classList.add('active');
                break;
        }
    }

    // Установить активную вкладку
    function setActiveTab(activeTab) {
        document.querySelectorAll('nav a').forEach(tab => {
            tab.classList.remove('active');
        });
        activeTab.classList.add('active');
    }

    // Авторизация
    function login() {
        const username = loginUsername.value.trim();
        const password = loginPassword.value;
        
        console.log('Попытка входа:', username);
        
        if (!username || !password) {
            showNotification('Введите логин и пароль');
            return;
        }
        
        if (usersDatabase[username] && usersDatabase[username].password === password) {
            currentUser = username;
            console.log('Вход успешен:', currentUser);
            
            updateUserDisplay();
            updateOpenCaseButtons();
            updateProfilePage();
            authModal.style.display = 'none';
            loginUsername.value = '';
            loginPassword.value = '';
            
            // Сохраняем текущего пользователя
            saveCurrentUser();
            
            // Обновляем админ-кнопку
            updateAdminButton();
            
            showNotification('Успешный вход!');
        } else {
            console.log('Неверный логин или пароль');
            showNotification('Неверный логин или пароль');
        }
    }

    // Регистрация
    function register() {
        const username = registerUsername.value.trim();
        const password = registerPassword.value;
        const confirm = registerConfirm.value;
        
        console.log('Попытка регистрации:', username);
        
        if (!username || !password || !confirm) {
            showNotification('Заполните все поля');
            return;
        }
        
        if (password !== confirm) {
            showNotification('Пароли не совпадают');
            return;
        }
        
        if (username.length < 3) {
            showNotification('Логин должен быть не менее 3 символов');
            return;
        }
        
        if (password.length < 6) {
            showNotification('Пароль должен быть не менее 6 символов');
            return;
        }
        
        if (usersDatabase[username]) {
            showNotification('Логин уже занят');
            return;
        }
        
        // Создаем нового пользователя
        usersDatabase[username] = {
            password: password,
            balance: 10000,
            casesOpened: 0,
            totalValue: 0,
            bestItem: "Нет",
            createdAt: new Date().toLocaleDateString(),
            isAdmin: false,
            inventory: [],
            supportChat: []
        };
        
        // Автоматически входим
        currentUser = username;
        console.log('Регистрация успешна, пользователь:', currentUser);
        
        updateUserDisplay();
        updateOpenCaseButtons();
        updateProfilePage();
        authModal.style.display = 'none';
        registerUsername.value = '';
        registerPassword.value = '';
        registerConfirm.value = '';
        
        // Сохраняем базу данных
        saveDatabases();
        saveCurrentUser();
        
        // Переключаемся на вкладку входа
        loginTab.click();
        
        showNotification('Регистрация успешна!');
    }

    // Выход из аккаунта
    function logout() {
        console.log('Выход из аккаунта:', currentUser);
        currentUser = null;
        updateUserDisplay();
        updateOpenCaseButtons();
        logoutHeaderBtn.style.display = 'none';
        adminBtn.classList.remove('visible');
        localStorage.removeItem('casewins_current_user');
        
        if (gameState.currentPage === 'profile') {
            showPage('cases');
        }
        
        showNotification('Вы вышли из аккаунта');
    }

    // Обновление отображения пользователя
    function updateUserDisplay() {
        console.log('Обновление отображения пользователя, currentUser:', currentUser);
        
        if (!currentUser) {
            userBalanceSpan.textContent = "0";
            userInitials.textContent = "G";
            logoutHeaderBtn.style.display = 'none';
            console.log('Пользователь не авторизован, отображаем гостя');
            return;
        }
        
        const user = usersDatabase[currentUser];
        userBalanceSpan.textContent = user.balance.toLocaleString();
        
        const initials = currentUser.substring(0, 2).toUpperCase();
        userInitials.textContent = initials;
        
        logoutHeaderBtn.style.display = 'flex';
        
        const colors = [
            'linear-gradient(45deg, #FF6B6B, #FF8E8E)',
            'linear-gradient(45deg, #4ECDC4, #88E0D0)',
            'linear-gradient(45deg, #FFD166, #FFE194)',
            'linear-gradient(45deg, #06D6A0, #4CE4B6)',
            'linear-gradient(45deg, #118AB2, #5AB0D3)',
            'linear-gradient(45deg, #EF476F, #F57C9E)'
        ];
        const colorIndex = currentUser.length % colors.length;
        userAvatarBtn.style.background = colors[colorIndex];
        
        console.log('Отображение пользователя обновлено:', currentUser);
    }

    // Обновление админ кнопки
    function updateAdminButton() {
        if (currentUser && usersDatabase[currentUser] && usersDatabase[currentUser].isAdmin) {
            adminBtn.classList.add('visible');
            console.log('Админ кнопка показана для пользователя:', currentUser);
        } else {
            adminBtn.classList.remove('visible');
        }
    }

    // Обновление кнопок открытия кейсов
    function updateOpenCaseButtons() {
        const isLoggedIn = currentUser !== null;
        console.log('Обновление кнопок открытия кейсов, авторизован:', isLoggedIn);
        
        openCaseButtons.forEach(btn => {
            if (isLoggedIn) {
                btn.disabled = false;
                btn.innerHTML = `<i class="fas fa-box-open"></i> Открыть кейс`;
            } else {
                btn.disabled = true;
                btn.innerHTML = `<i class="fas fa-lock"></i> Войдите для открытия`;
            }
        });
        
        spinBtn.disabled = !isLoggedIn;
        centerOpenBtn.disabled = !isLoggedIn;
    }

    // Обновление страницы профиля
    function updateProfilePage() {
        if (!currentUser) {
            console.log('Не могу обновить профиль: пользователь не авторизован');
            return;
        }
        
        console.log('Обновление страницы профиля для:', currentUser);
        
        const user = usersDatabase[currentUser];
        profilePageBalance.textContent = user.balance.toLocaleString();
        profilePageName.textContent = currentUser;
        profilePageCases.textContent = user.casesOpened;
        profilePageTotal.textContent = user.totalValue.toLocaleString();
        profilePageBest.textContent = user.bestItem;
        profilePageCreated.textContent = user.createdAt;
        
        const initials = currentUser.substring(0, 2).toUpperCase();
        profilePageInitials.textContent = initials;
        
        const colors = [
            'linear-gradient(45deg, #FF6B6B, #FF8E8E)',
            'linear-gradient(45deg, #4ECDC4, #88E0D0)',
            'linear-gradient(45deg, #FFD166, #FFE194)',
            'linear-gradient(45deg, #06D6A0, #4CE4B6)',
            'linear-gradient(45deg, #118AB2, #5AB0D3)',
            'linear-gradient(45deg, #EF476F, #F57C9E)'
        ];
        const colorIndex = currentUser.length % colors.length;
        profilePageAvatar.style.background = colors[colorIndex];
        
        updateInventory();
    }

    // Обновление инвентаря
    function updateInventory() {
        if (!currentUser) return;
        
        const user = usersDatabase[currentUser];
        inventoryGrid.innerHTML = '';
        
        if (!user.inventory || user.inventory.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.style.textAlign = 'center';
            emptyMessage.style.padding = '40px';
            emptyMessage.style.color = 'rgba(255, 255, 255, 0.6)';
            emptyMessage.style.gridColumn = '1 / -1';
            emptyMessage.innerHTML = `
                <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 15px;"></i>
                <div style="font-size: 18px;">Ваш инвентарь пуст</div>
                <div style="font-size: 14px; margin-top: 10px;">Откройте кейсы, чтобы получить предметы</div>
            `;
            inventoryGrid.appendChild(emptyMessage);
            return;
        }
        
        user.inventory.forEach((item, index) => {
            const itemCard = document.createElement('div');
            itemCard.className = `inventory-item ${item.sold ? 'sold' : ''}`;
            
            itemCard.innerHTML = `
                <img src="${item.img}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/140x105/333/fff?text=SKIN'">
                <div style="text-align: center;">
                    <div style="font-size: 14px; font-weight: 700; margin-bottom: 8px;">${item.name}</div>
                    <div style="color: #ffd700; font-weight: 800; margin-bottom: 8px;">${item.value} <i class="fas fa-coins"></i></div>
                    <div class="item-status ${item.sold ? 'status-sold' : 'status-active'}">
                        ${item.sold ? 'ПРОДАНО' : 'АКТИВНО'}
                    </div>
                </div>
                ${!item.sold ? `
                <button class="sell-item-btn" data-index="${index}" style="background: linear-gradient(45deg, var(--red-color), #ff4066); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 700; width: 100%;">
                    <i class="fas fa-money-bill-wave"></i> Продать
                </button>
                ` : ''}
            `;
            
            if (!item.sold) {
                const sellBtn = itemCard.querySelector('.sell-item-btn');
                sellBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    sellInventoryItem(index);
                });
            }
            
            inventoryGrid.appendChild(itemCard);
        });
    }

    // Фильтрация инвентаря
    function filterInventory(filter) {
        const items = inventoryGrid.querySelectorAll('.inventory-item');
        
        items.forEach(item => {
            switch(filter) {
                case 'all':
                    item.style.display = 'flex';
                    break;
                case 'active':
                    item.style.display = item.classList.contains('sold') ? 'none' : 'flex';
                    break;
                case 'sold':
                    item.style.display = item.classList.contains('sold') ? 'flex' : 'none';
                    break;
            }
        });
    }

    // Продажа предмета из инвентаря
    function sellInventoryItem(index) {
        if (!currentUser) return;
        
        const user = usersDatabase[currentUser];
        if (!user.inventory || index >= user.inventory.length) return;
        
        const item = user.inventory[index];
        
        user.inventory[index].sold = true;
        user.balance += item.value;
        
        updateUserDisplay();
        updateProfilePage();
        saveDatabases();
        
        showNotification(`Предмет "${item.name}" продан за ${item.value} монет!`);
    }

    // Открыть кейс
    function openCase(caseId) {
        if (!currentUser) {
            authModal.style.display = 'flex';
            return;
        }
        
        gameState.selectedCase = caseId;
        const caseData = casesData[caseId];
        const user = usersDatabase[currentUser];
        
        if (user.balance < caseData.price) {
            showNotification('Недостаточно средств для открытия кейса!');
            return;
        }
        
        user.balance -= caseData.price;
        user.casesOpened++;
        
        gameState.isSpinning = true;
        spinBtn.disabled = true;
        centerOpenBtn.disabled = true;
        spinBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Открываем...`;
        
        const randomItem = getRandomItemWithChance(caseData);
        gameState.spinResult = randomItem;
        
        let rarity = 'common';
        if (randomItem.value >= 8000) rarity = 'ancient';
        else if (randomItem.value >= 5000) rarity = 'legendary';
        else if (randomItem.value >= 2000) rarity = 'mythical';
        else if (randomItem.value >= 800) rarity = 'rare';
        else if (randomItem.value >= 300) rarity = 'uncommon';
        
        const scrollItems = caseItemsScroll.querySelectorAll('.scroll-item');
        const totalItems = scrollItems.length;
        
        let targetIndex = 0;
        for (let i = 0; i < totalItems; i++) {
            const itemName = scrollItems[i].querySelector('.scroll-item-name').textContent;
            if (itemName === randomItem.name) {
                targetIndex = i;
                break;
            }
        }
        
        scrollItems.forEach(item => item.classList.remove('active'));
        
        let currentPosition = 0;
        const targetPosition = -targetIndex * 240;
        const duration = 2500;
        const startTime = Date.now();
        
        const animateScroll = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            let easing;
            if (progress < 0.8) {
                easing = progress * 1.2;
            } else {
                easing = 0.96 + (progress - 0.8) * 0.2;
            }
            
            currentPosition = targetPosition * easing;
            caseItemsScroll.style.transform = `translateX(${currentPosition}px)`;
            
            if (progress > 0.9) {
                const centerIndex = Math.round(-currentPosition / 240) % totalItems;
                if (centerIndex >= 0 && centerIndex < totalItems) {
                    scrollItems.forEach((item, i) => {
                        item.classList.toggle('active', i === centerIndex);
                    });
                }
            }
            
            if (progress < 1) {
                requestAnimationFrame(animateScroll);
            } else {
                setTimeout(() => {
                    showResultModal(randomItem, rarity);
                    
                    if (!user.inventory) user.inventory = [];
                    user.inventory.push({
                        ...randomItem,
                        sold: false,
                        droppedAt: new Date().toLocaleString()
                    });
                    
                    user.totalValue += randomItem.value;
                    if (user.bestItem === "Нет" || randomItem.value > getItemValue(user.bestItem)) {
                        user.bestItem = randomItem.name;
                    }
                    
                    addToRecentDrops(randomItem);
                    
                    updateUserDisplay();
                    updateProfilePage();
                    saveDatabases();
                    
                    gameState.isSpinning = false;
                    spinBtn.disabled = false;
                    centerOpenBtn.disabled = false;
                    spinBtn.innerHTML = `<i class="fas fa-play"></i> Открыть за <span id="spin-price">${caseData.price.toLocaleString()}</span>`;
                }, 500);
            }
        };
        
        requestAnimationFrame(animateScroll);
    }

    // Открыть вид открытия кейса
    function openCaseView(caseId) {
        if (!currentUser) {
            authModal.style.display = 'flex';
            return;
        }
        
        gameState.selectedCase = caseId;
        const caseData = casesData[caseId];
        
        openingCaseName.textContent = caseData.name;
        spinPriceSpan.textContent = caseData.price.toLocaleString();
        
        initCaseScroll(caseData);
        initItemsPreview(caseData);
        
        caseOpeningSection.classList.add('active');
        caseSelection.style.display = 'none';
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Инициализация прокрутки кейсов
    function initCaseScroll(caseData) {
        caseItemsScroll.innerHTML = '';
        
        const items = [...caseData.items, ...caseData.items, ...caseData.items, ...caseData.items];
        
        items.forEach((item, index) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'scroll-item';
            itemElement.innerHTML = `
                <img src="${item.img}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/180x135/333/fff?text=SKIN'">
                <div class="scroll-item-name">${item.name}</div>
                <div class="scroll-item-price">${item.value} <i class="fas fa-coins"></i></div>
            `;
            
            let rarity = 'common';
            if (item.value >= 8000) rarity = 'ancient';
            else if (item.value >= 5000) rarity = 'legendary';
            else if (item.value >= 2000) rarity = 'mythical';
            else if (item.value >= 800) rarity = 'rare';
            else if (item.value >= 300) rarity = 'uncommon';
            
            itemElement.classList.add(`rarity-${rarity}`);
            caseItemsScroll.appendChild(itemElement);
        });
    }

    // Инициализация превью предметов
    function initItemsPreview(caseData) {
        itemsPreview.innerHTML = '';
        
        const uniqueItems = [];
        const seen = new Set();
        
        caseData.items.forEach(item => {
            if (!seen.has(item.name)) {
                seen.add(item.name);
                uniqueItems.push(item);
            }
        });
        
        uniqueItems.sort((a, b) => b.value - a.value);
        
        uniqueItems.slice(0, 12).forEach(item => {
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            
            let rarity = 'common';
            if (item.value >= 8000) rarity = 'ancient';
            else if (item.value >= 5000) rarity = 'legendary';
            else if (item.value >= 2000) rarity = 'mythical';
            else if (item.value >= 800) rarity = 'rare';
            else if (item.value >= 300) rarity = 'uncommon';
            
            previewItem.innerHTML = `
                <img src="${item.img}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/120x90/333/fff?text=SKIN'">
                <div class="preview-name">${item.name}</div>
                <div class="preview-price">${item.value} <i class="fas fa-coins"></i></div>
            `;
            
            previewItem.classList.add(`rarity-${rarity}`);
            itemsPreview.appendChild(previewItem);
        });
    }

    // Получение случайного предмета с учетом шансов
    function getRandomItemWithChance(caseData) {
        const items = caseData.items;
        const legendaryChance = caseData.legendaryChance;
        
        const isLegendary = Math.random() * 100 < legendaryChance;
        
        if (isLegendary) {
            const legendaryItems = items.filter(item => item.value >= 5000);
            if (legendaryItems.length > 0) {
                return legendaryItems[Math.floor(Math.random() * legendaryItems.length)];
            }
        }
        
        const weights = items.map(item => {
            if (item.value >= 2000) return 1;
            if (item.value >= 800) return 3;
            if (item.value >= 300) return 5;
            return 10;
        });
        
        const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
        let random = Math.random() * totalWeight;
        
        for (let i = 0; i < items.length; i++) {
            random -= weights[i];
            if (random <= 0) {
                return items[i];
            }
        }
        
        return items[0];
    }

    // Получение стоимости предмета по названию
    function getItemValue(itemName) {
        for (const color in skinData) {
            const item = skinData[color].find(i => i.name === itemName);
            if (item) return item.value;
        }
        return 0;
    }

    // Показать модальное окно с результатом
    function showResultModal(item, rarity) {
        wonItemImg.src = item.img;
        wonItemName.textContent = item.name;
        wonItemPrice.textContent = `Цена: ${item.value} <i class="fas fa-coins"></i>`;
        wonItemRarity.textContent = getRarityName(rarity);
        wonItemRarity.className = 'item-rarity';
        wonItemRarity.classList.add(`rarity-${rarity}`);
        
        resultModal.style.display = 'flex';
    }

    // Продать выигранный предмет
    function sellWonItem() {
        if (!currentUser || !gameState.spinResult) return;
        
        const user = usersDatabase[currentUser];
        const item = gameState.spinResult;
        
        user.balance += item.value;
        
        updateUserDisplay();
        updateProfilePage();
        saveDatabases();
        
        resultModal.style.display = 'none';
        showNotification(`Предмет "${item.name}" продан за ${item.value} монет!`);
    }

    // Загрузка истории выпадений
    function loadRecentDrops() {
        const initialDrops = [
            { user: "ProPlayer", item: skinData.yellow[0], time: "2 мин назад" },
            { user: "LuckyGuy", item: skinData.red[2], time: "5 мин назад" },
            { user: "CS2Fan", item: skinData.pink[1], time: "10 мин назад" },
            { user: "Trader", item: skinData.purple[3], time: "15 мин назад" },
            { user: "Newbie", item: skinData.blue[0], time: "20 мин назад" },
            { user: "Veteran", item: skinData.yellow[1], time: "25 мин назад" },
            { user: "Gambler", item: skinData.blue[2], time: "30 мин назад" }
        ];
        
        initialDrops.forEach(drop => {
            gameState.recentDrops.push(drop);
        });
    }

    // Запуск анимации выпадений
    function startDropAnimation() {
        let dropIndex = 0;
        
        function createDrop() {
            const oldDrops = dropsContainer.querySelectorAll('.drop-item[style*="animation"]');
            oldDrops.forEach(drop => drop.remove());
            
            if (dropIndex >= gameState.recentDrops.length) {
                dropIndex = 0;
            }
            
            const drop = gameState.recentDrops[dropIndex];
            addDropToSidebar(drop.user, drop.item, drop.time);
            dropIndex++;
            
            const nextDropTime = 20000 + Math.random() * 30000;
            setTimeout(createDrop, nextDropTime);
        }
        
        setTimeout(createDrop, 2000);
    }

    // Добавление выпадения в боковую панель
    function addDropToSidebar(username, item, time) {
        const dropItem = document.createElement('div');
        dropItem.className = 'drop-item';
        
        let rarity = 'common';
        if (item.value >= 8000) rarity = 'ancient';
        else if (item.value >= 5000) rarity = 'legendary';
        else if (item.value >= 2000) rarity = 'mythical';
        else if (item.value >= 800) rarity = 'rare';
        else if (item.value >= 300) rarity = 'uncommon';
        
        let borderColor = '#969696';
        if (rarity === 'uncommon') borderColor = '#4db53a';
        else if (rarity === 'rare') borderColor = '#4c6ef4';
        else if (rarity === 'mythical') borderColor = '#b6509b';
        else if (rarity === 'legendary') borderColor = '#ffd700';
        else if (rarity === 'ancient') borderColor = '#eb4b4b';
        
        dropItem.style.borderLeftColor = borderColor;
        
        const avatarColor = getAvatarColor(username);
        const initials = username.substring(0, 2).toUpperCase();
        
        dropItem.innerHTML = `
            <div class="drop-avatar" style="background: ${avatarColor};">
                <span>${initials}</span>
            </div>
            <div class="drop-info">
                <div class="drop-user">
                    <span>${username}</span>
                    <span>${time}</span>
                </div>
                <div class="drop-item-name">${item.name}</div>
                <div class="drop-value">${item.value} <i class="fas fa-coins"></i></div>
            </div>
        `;
        
        const delay = Math.random() * 5;
        dropItem.style.animationDelay = `${delay}s`;
        
        dropsContainer.appendChild(dropItem);
    }

    // Добавление в историю выпадений
    function addToRecentDrops(item) {
        const drop = {
            user: currentUser,
            item: item,
            time: "Только что"
        };
        
        gameState.recentDrops.unshift(drop);
        if (gameState.recentDrops.length > 20) {
            gameState.recentDrops.pop();
        }
    }

    // Получение цвета для аватара
    function getAvatarColor(username) {
        const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2', '#EF476F'];
        const index = username.length % colors.length;
        return colors[index];
    }

    // Проверка пароля админ-панели
    function checkAdminPassword() {
        if (adminPasswordInput.value === "admin123") {
            adminContent.style.display = 'block';
            
            if (currentUser && usersDatabase[currentUser]) {
                adminBalanceInput.value = usersDatabase[currentUser].balance;
            }
            adminCase1PriceInput.value = casesData[1].price;
            adminCase2PriceInput.value = casesData[2].price;
            adminCase3PriceInput.value = casesData[3].price;
            adminCase4PriceInput.value = casesData[4].price;
            adminCase5PriceInput.value = casesData[5].price;
            
            loadAdminSupportChat();
        } else {
            showNotification('Неверный пароль!');
        }
    }

    // Загрузка чата поддержки в админ-панели
    function loadAdminSupportChat() {
        adminChatMessages.innerHTML = '';
        
        let hasActiveChats = false;
        
        for (const username in usersDatabase) {
            const user = usersDatabase[username];
            if (user.supportChat && user.supportChat.length > 0) {
                hasActiveChats = true;
                
                user.supportChat.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `chat-message ${message.sender === 'admin' ? 'message-admin' : 'message-user'}`;
                    messageDiv.innerHTML = `
                        <div style="font-weight: 700; margin-bottom: 5px;">${message.sender === 'admin' ? 'Администратор' : username}</div>
                        <div>${message.text}</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">${message.time}</div>
                    `;
                    adminChatMessages.appendChild(messageDiv);
                });
                
                adminChatInput.dataset.user = username;
                adminChatActions.style.display = 'flex';
                break;
            }
        }
        
        if (!hasActiveChats) {
            const noMessages = document.createElement('div');
            noMessages.style.textAlign = 'center';
            noMessages.style.padding = '40px';
            noMessages.style.color = 'rgba(255, 255, 255, 0.6)';
            noMessages.innerHTML = 'Нет активных чатов поддержки';
            adminChatMessages.appendChild(noMessages);
            adminChatActions.style.display = 'none';
        }
        
        adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
    }

    // Отправка сообщения администратора
    function sendAdminMessage() {
        const message = adminChatInput.value.trim();
        const username = adminChatInput.dataset.user;
        
        if (!message || !username) return;
        
        const user = usersDatabase[username];
        if (!user.supportChat) user.supportChat = [];
        
        user.supportChat.push({
            sender: 'admin',
            text: message,
            time: new Date().toLocaleTimeString()
        });
        
        // Сохраняем в базе данных поддержки
        if (!supportDatabase[username]) {
            supportDatabase[username] = { messages: [], lastUpdate: Date.now() };
        }
        supportDatabase[username].messages.push({
            sender: 'admin',
            text: message,
            time: new Date().toISOString()
        });
        supportDatabase[username].lastUpdate = Date.now();
        
        saveDatabases();
        
        loadAdminSupportChat();
        
        adminChatInput.value = '';
        
        showNotification('Сообщение отправлено');
    }

    // Решение чата поддержки
    function resolveSupportChat() {
        const username = adminChatInput.dataset.user;
        if (!username) return;
        
        const user = usersDatabase[username];
        if (!user.supportChat) user.supportChat = [];
        
        user.supportChat.push({
            sender: 'admin',
            text: 'Спасибо за обращение, всего доброго!',
            time: new Date().toLocaleTimeString(),
            resolved: true
        });
        
        // Сохраняем в базе данных
        if (!supportDatabase[username]) {
            supportDatabase[username] = { messages: [], lastUpdate: Date.now() };
        }
        supportDatabase[username].messages.push({
            sender: 'admin',
            text: 'Спасибо за обращение, всего доброго!',
            time: new Date().toISOString(),
            resolved: true
        });
        
        setTimeout(() => {
            if (usersDatabase[username]) {
                usersDatabase[username].supportChat = [];
                if (supportDatabase[username]) {
                    supportDatabase[username].messages = [];
                }
                saveDatabases();
            }
        }, 10 * 60 * 1000);
        
        saveDatabases();
        
        loadAdminSupportChat();
        
        showNotification('Чат поддержки решен');
    }

    // Закрытие чата поддержки
    function closeSupportChat() {
        const username = adminChatInput.dataset.user;
        if (!username) return;
        
        if (usersDatabase[username]) {
            usersDatabase[username].supportChat = [];
            if (supportDatabase[username]) {
                supportDatabase[username].messages = [];
            }
            saveDatabases();
        }
        
        loadAdminSupportChat();
        
        showNotification('Чат поддержки закрыт');
    }

    // Сохранение настроек админ-панели
    function saveAdminSettings() {
        if (currentUser && usersDatabase[currentUser]) {
            usersDatabase[currentUser].balance = parseInt(adminBalanceInput.value);
        }
        
        casesData[1].price = parseInt(adminCase1PriceInput.value);
        casesData[2].price = parseInt(adminCase2PriceInput.value);
        casesData[3].price = parseInt(adminCase3PriceInput.value);
        casesData[4].price = parseInt(adminCase4PriceInput.value);
        casesData[5].price = parseInt(adminCase5PriceInput.value);
        
        document.querySelectorAll('.case-price-value').forEach((span, index) => {
            span.textContent = casesData[index + 1].price.toLocaleString();
        });
        
        updateUserDisplay();
        saveDatabases();
        
        adminModal.style.display = 'none';
        
        showNotification('Настройки успешно сохранены!');
    }

    // Показать модальное окно поддержки
    function showSupportModal() {
        if (!currentUser) {
            authModal.style.display = 'flex';
            return;
        }
        
        supportModalElement.style.display = 'flex';
        loadSupportChat();
    }

    // Загрузка чата поддержки пользователя
    function loadSupportChat() {
        supportChatMessages.innerHTML = '';
        
        if (!currentUser) return;
        
        const user = usersDatabase[currentUser];
        
        if (!user.supportChat || user.supportChat.length === 0) {
            const welcomeMessage = document.createElement('div');
            welcomeMessage.className = 'chat-message message-admin';
            welcomeMessage.innerHTML = `
                <div style="font-weight: 700; margin-bottom: 5px;">Поддержка</div>
                <div>Здравствуйте! Чем могу помочь?</div>
            `;
            supportChatMessages.appendChild(welcomeMessage);
        } else {
            user.supportChat.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${message.sender === 'admin' ? 'message-admin' : 'message-user'}`;
                messageDiv.innerHTML = `
                    <div style="font-weight: 700; margin-bottom: 5px;">${message.sender === 'admin' ? 'Поддержка' : 'Вы'}</div>
                    <div>${message.text}</div>
                    <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">${message.time}</div>
                `;
                
                if (message.resolved) {
                    messageDiv.style.opacity = '0.7';
                }
                
                supportChatMessages.appendChild(messageDiv);
            });
        }
        
        supportChatMessages.scrollTop = supportChatMessages.scrollHeight;
    }

    // Отправка сообщения в поддержку
    function sendSupportMessage() {
        if (!currentUser) return;
        
        const message = supportChatInput.value.trim();
        if (!message) return;
        
        const user = usersDatabase[currentUser];
        if (!user.supportChat) user.supportChat = [];
        
        user.supportChat.push({
            sender: 'user',
            text: message,
            time: new Date().toLocaleTimeString()
        });
        
        // Сохраняем в базе данных поддержки
        if (!supportDatabase[currentUser]) {
            supportDatabase[currentUser] = { messages: [], lastUpdate: Date.now() };
        }
        supportDatabase[currentUser].messages.push({
            sender: 'user',
            text: message,
            time: new Date().toISOString()
        });
        supportDatabase[currentUser].lastUpdate = Date.now();
        
        saveDatabases();
        
        loadSupportChat();
        
        supportChatInput.value = '';
        
        showNotification('Сообщение отправлено в поддержку');
    }

    // Получение названия редкости
    function getRarityName(rarity) {
        const names = {
            'common': 'Обычный',
            'uncommon': 'Необычный',
            'rare': 'Редкий',
            'mythical': 'Мифический',
            'legendary': 'Легендарный',
            'ancient': 'Древний'
        };
        return names[rarity] || rarity;
    }

    // Показать уведомление
    function showNotification(message) {
        const oldNotification = document.querySelector('.notification');
        if (oldNotification) {
            document.body.removeChild(oldNotification);
        }
        
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // Запуск инициализации после загрузки страницы
    document.addEventListener('DOMContentLoaded', init);
    
    // Обработка видимости вкладки для фикса анимации дропов
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            const animatedDrops = dropsContainer.querySelectorAll('.drop-item[style*="animation"]');
            animatedDrops.forEach(drop => drop.remove());
            startDropAnimation();
        }
    });
</script>
</body>
</html>

