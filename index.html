
            
            const uniqueItems = [];
            const seen = new Set();
            
            caseData.items.forEach(item => {
                if (!seen.has(item.name)) {
                    seen.add(item.name);
                    uniqueItems.push(item);
                }
            });
            
            uniqueItems.sort((a, b) => b.value - a.value);
            uniqueItems.slice(0, 12).forEach(item => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const rarity = item.rarity;
                const rarityColor = getRarityColor(rarity);
                
                previewItem.style.borderColor = rarityColor;
                
                const words = item.name.split(' ');
                let displayName = '';
                for (let i = 0; i < words.length; i++) {
                    displayName += words[i] + (i % 2 === 1 ? '\n' : ' ');
                }
                
                previewItem.innerHTML = `
                    <div class="item-img item-${rarity}"></div>
                    <div class="preview-name">${displayName}</div>
                    <div class="preview-price">${item.value} <i class="fas fa-coins"></i></div>
                `;
                
                previewItem.classList.add(`rarity-${rarity}`);
                itemsPreview.appendChild(previewItem);
            });
        }

        function updateUserDisplay() {
            if (!currentUser) {
                userBalanceSpan.textContent = "0";
                userAvatarBtn.querySelector('img').src = "https://cdn-icons-png.flaticon.com/512/847/847969.png";
                return;
            }
            
            const user = db.getUser(currentUser);
            if (!user) return;
            
            userBalanceSpan.textContent = user.balance.toLocaleString();
            updateAvatar(currentUser, userAvatarBtn.querySelector('img'));
        }

        function updateAvatar(username, imgElement) {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2', '#EF476F'];
            const colorIndex = username.length % colors.length;
            const avatarColor = colors[colorIndex];
            
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = avatarColor;
            ctx.fillRect(0, 0, 100, 100);
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const initials = username.substring(0, 2).toUpperCase();
            ctx.fillText(initials, 50, 50);
            
            const avatarUrl = canvas.toDataURL();
            imgElement.src = avatarUrl;
        }

        function updateOnlineCount() {
            const count = Math.floor(Math.random() * 100) + 152;
            onlineCount.textContent = count;
        }

        function updateOpenCaseButtons() {
            const isLoggedIn = currentUser !== null;
            
            document.querySelectorAll('.open-case-btn').forEach(btn => {
                if (isLoggedIn) {
                    btn.disabled = false;
                    btn.innerHTML = `<i class="fas fa-box-open"></i> Открыть кейс`;
                } else {
                    btn.disabled = true;
                    btn.innerHTML = `<i class="fas fa-lock"></i> Войдите для открытия`;
                }
            });
            
            spinBtn.disabled = !isLoggedIn;
        }

        function login() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value;
            
            if (!username || !password) {
                loginError.textContent = "Введите логин и пароль";
                loginError.style.display = 'block';
                return;
            }
            
            const user = db.getUser(username);
            
            if (user && user.password === password) {
                currentUser = username;
                db.setCurrentUser(username);
                
                updateUserDisplay();
                updateOpenCaseButtons();
                authModal.style.display = 'none';
                loginUsername.value = '';
                loginPassword.value = '';
                loginError.style.display = 'none';
                
                profileTab.style.display = 'flex';
                if (user.isAdmin) {
                    adminBtn.classList.add('visible');
                }
                
                checkPendingCaseItems();
                checkPendingUpgrade();
                
                alert('Вы успешно вошли в аккаунт!');
            } else {
                loginError.textContent = "Неверный логин или пароль";
                loginError.style.display = 'block';
            }
        }

        function register() {
            const username = registerUsername.value.trim();
            const password = registerPassword.value;
            const confirm = registerConfirm.value;
            
            if (!username || !password || !confirm) {
                registerError.textContent = "Заполните все поля";
                registerError.style.display = 'block';
                return;
            }
            
            if (password !== confirm) {
                registerError.textContent = "Пароли не совпадают";
                registerError.style.display = 'block';
                return;
            }
            
            if (username.length < 3) {
                registerError.textContent = "Логин должен быть не менее 3 символов";
                registerError.style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                registerError.textContent = "Пароль должен быть не менее 6 символов";
                registerError.style.display = 'block';
                return;
            }
            
            if (db.getUser(username)) {
                registerError.textContent = "Логин уже занят";
                registerError.style.display = 'block';
                return;
            }
            
            const userData = {
                password: password,
                balance: systemSettings.defaultBalance,
                casesOpened: 0,
                totalValue: 0,
                bestItem: "Нет",
                createdAt: new Date().toLocaleDateString(),
                isAdmin: false,
                inventory: []
            };
            
            db.saveUser(username, userData);
            currentUser = username;
            db.setCurrentUser(username);
            
            updateUserDisplay();
            updateOpenCaseButtons();
            authModal.style.display = 'none';
            registerUsername.value = '';
            registerPassword.value = '';
            registerConfirm.value = '';
            registerError.style.display = 'none';
            
            profileTab.style.display = 'flex';
            
            alert('Аккаунт успешно создан! Вы вошли в систему.');
            loginTab.click();
        }

        function getAvatarColor(username) {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2', '#EF476F'];
            const index = username.length % colors.length;
            return colors[index];
        }

        function getRarityColor(rarity) {
            const colors = {
                'common': '#5e98d9',
                'uncommon': '#4b69ff',
                'rare': '#8847ff',
                'mythical': '#d32ee6',
                'legendary': '#ffd700',
                'ancient': '#eb4b4b'
            };
            return colors[rarity] || '#969696';
        }

        function getRarityName(rarity) {
            const names = {
                'common': 'Армейское',
                'uncommon': 'Запрещенное',
                'rare': 'Засекреченное',
                'mythical': 'Тайное',
                'legendary': 'Ножевое',
                'ancient': 'Древнее'
            };
            return names[rarity] || rarity;
        }

        function getItemValue(itemName) {
            for (const rarity in cs2Items) {
                const item = cs2Items[rarity].find(i => i.name === itemName);
                if (item) return item.value;
            }
            return 0;
        }

        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('resize', updateOnlineCount);
        setInterval(updateOnlineCount, 30000);
        updateOnlineCount();
    </script>
</body>
</html>

